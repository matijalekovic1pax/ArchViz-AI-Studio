{
  "version": 3,
  "sources": ["../bundle-RGYhRm/checked-fetch.js", "../../../worker.js", "../../../../../../../AppData/Roaming/npm/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../../../../../AppData/Roaming/npm/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-RGYhRm/middleware-insertion-facade.js", "../../../../../../../AppData/Roaming/npm/node_modules/wrangler/templates/middleware/common.ts", "../bundle-RGYhRm/middleware-loader.entry.ts"],
  "sourceRoot": "C:\\Users\\1Pax Mateja\\Documents\\ArchViz\\ArchViz-AI-Studio\\cloudflare-worker\\.wrangler\\tmp\\dev-l76tBA",
  "sourcesContent": ["const urls = new Set();\n\nfunction checkURL(request, init) {\n\tconst url =\n\t\trequest instanceof URL\n\t\t\t? request\n\t\t\t: new URL(\n\t\t\t\t\t(typeof request === \"string\"\n\t\t\t\t\t\t? new Request(request, init)\n\t\t\t\t\t\t: request\n\t\t\t\t\t).url\n\t\t\t\t);\n\tif (url.port && url.port !== \"443\" && url.protocol === \"https:\") {\n\t\tif (!urls.has(url.toString())) {\n\t\t\turls.add(url.toString());\n\t\t\tconsole.warn(\n\t\t\t\t`WARNING: known issue with \\`fetch()\\` requests to custom HTTPS ports in published Workers:\\n` +\n\t\t\t\t\t` - ${url.toString()} - the custom port will be ignored when the Worker is published using the \\`wrangler deploy\\` command.\\n`\n\t\t\t);\n\t\t}\n\t}\n}\n\nglobalThis.fetch = new Proxy(globalThis.fetch, {\n\tapply(target, thisArg, argArray) {\n\t\tconst [request, init] = argArray;\n\t\tcheckURL(request, init);\n\t\treturn Reflect.apply(target, thisArg, argArray);\n\t},\n});\n", "/**\r\n * ArchViz AI Studio \u2014 API Gateway (Cloudflare Worker)\r\n *\r\n * Handles:\r\n * - Google ID token verification + short-lived JWT issuance\r\n * - JWT-authenticated proxy for all vendor APIs\r\n * - CORS lockdown to production domain\r\n * - Payload size limits\r\n *\r\n * Secrets (set via `wrangler secret put`):\r\n *   JWT_SECRET, GOOGLE_CLIENT_ID, ALLOWED_DOMAIN,\r\n *   GEMINI_API_KEY, VERTEX_AI_TOKEN, GOOGLE_PROJECT_ID,\r\n *   KLING_PIAPI_API_KEY, KLING_ULAZAI_API_KEY, KLING_WAVESPEEDAI_API_KEY,\r\n *   CONVERTAPI_SECRET, ILOVEPDF_PUBLIC_KEY\r\n */\r\n\r\n// \u2500\u2500\u2500 Configuration \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nconst ALLOWED_ORIGINS = [\r\n  'https://arch-viz-ai-studio.vercel.app',\r\n  'http://localhost:3000',\r\n  'http://localhost:5173',\r\n];\r\n\r\nconst MAX_PAYLOAD_BYTES = 25 * 1024 * 1024; // 25 MB\r\nconst JWT_EXPIRY_SECONDS = 7200; // 2 hours\r\n\r\nconst GEMINI_API_BASE = 'https://generativelanguage.googleapis.com/v1beta';\r\nconst VERTEX_AI_BASE  = 'https://us-central1-aiplatform.googleapis.com/v1';\r\nconst CONVERTAPI_BASE = 'https://v2.convertapi.com';\r\nconst ILOVEPDF_BASE   = 'https://api.ilovepdf.com/v1';\r\n\r\nconst KLING_ENDPOINTS = {\r\n  piapi:       { base: 'https://api.piapi.ai/api/kling/v1' },\r\n  ulazai:      { base: 'https://api.ulazai.com/v1/kling' },\r\n  wavespeedai: { base: 'https://api.wavespeed.ai/v1/kling' },\r\n};\r\n\r\n// Vertex AI polling\r\nconst QUICK_POLL_ATTEMPTS = 3;\r\nconst POLL_INTERVAL_MS = 2000;\r\n\r\n// \u2500\u2500\u2500 Utilities \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nfunction sleep(ms) {\r\n  return new Promise(resolve => setTimeout(resolve, ms));\r\n}\r\n\r\n/**\r\n * Retry a fetch call with exponential backoff.\r\n * @param {Function} fn - Async function receiving (signal) that returns a Response\r\n * @param {Object} options\r\n * @param {number} [options.maxRetries=2] - Max retry attempts\r\n * @param {number} [options.timeoutMs=30000] - Per-attempt timeout\r\n * @param {string} [options.label='request'] - Label for error messages\r\n */\r\nasync function fetchWithRetry(fn, options = {}) {\r\n  const { maxRetries = 2, timeoutMs = 30000, label = 'request' } = options;\r\n  let lastError;\r\n\r\n  for (let attempt = 0; attempt <= maxRetries; attempt++) {\r\n    try {\r\n      const controller = new AbortController();\r\n      const timeoutId = setTimeout(() => controller.abort(), timeoutMs);\r\n      try {\r\n        const result = await fn(controller.signal);\r\n        clearTimeout(timeoutId);\r\n        return result;\r\n      } catch (err) {\r\n        clearTimeout(timeoutId);\r\n        throw err;\r\n      }\r\n    } catch (err) {\r\n      lastError = err;\r\n      if (attempt < maxRetries) {\r\n        const delay = Math.min(1000 * Math.pow(2, attempt), 8000);\r\n        await sleep(delay);\r\n      }\r\n    }\r\n  }\r\n  throw lastError || new Error(`${label} failed after ${maxRetries + 1} attempts`);\r\n}\r\n\r\n/** Base64url encode a buffer or string */\r\nfunction base64UrlEncode(data) {\r\n  const bytes = typeof data === 'string' ? new TextEncoder().encode(data) : new Uint8Array(data);\r\n  let binary = '';\r\n  for (const b of bytes) binary += String.fromCharCode(b);\r\n  return btoa(binary).replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=+$/, '');\r\n}\r\n\r\n/** Base64url decode to Uint8Array */\r\nfunction base64UrlDecode(str) {\r\n  str = str.replace(/-/g, '+').replace(/_/g, '/');\r\n  while (str.length % 4) str += '=';\r\n  const binary = atob(str);\r\n  const bytes = new Uint8Array(binary.length);\r\n  for (let i = 0; i < binary.length; i++) bytes[i] = binary.charCodeAt(i);\r\n  return bytes;\r\n}\r\n\r\n// \u2500\u2500\u2500 CORS \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nfunction getCorsHeaders(origin) {\r\n  const allowed = ALLOWED_ORIGINS.includes(origin) ? origin : ALLOWED_ORIGINS[0];\r\n  return {\r\n    'Access-Control-Allow-Origin': allowed,\r\n    'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',\r\n    'Access-Control-Allow-Headers': 'Content-Type, Authorization',\r\n    'Access-Control-Max-Age': '86400',\r\n  };\r\n}\r\n\r\nfunction corsResponse(origin, body, init = {}) {\r\n  const headers = { ...getCorsHeaders(origin), 'Content-Type': 'application/json', ...(init.headers || {}) };\r\n  return new Response(typeof body === 'string' ? body : JSON.stringify(body), { ...init, headers });\r\n}\r\n\r\nfunction handleOptions(request) {\r\n  const origin = request.headers.get('Origin') || '';\r\n  return new Response(null, { status: 204, headers: getCorsHeaders(origin) });\r\n}\r\n\r\n// \u2500\u2500\u2500 JWT (HS256) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function importHmacKey(secret) {\r\n  return crypto.subtle.importKey(\r\n    'raw',\r\n    new TextEncoder().encode(secret),\r\n    { name: 'HMAC', hash: 'SHA-256' },\r\n    false,\r\n    ['sign', 'verify']\r\n  );\r\n}\r\n\r\nasync function signJwt(payload, secret) {\r\n  const key = await importHmacKey(secret);\r\n  const header = base64UrlEncode(JSON.stringify({ alg: 'HS256', typ: 'JWT' }));\r\n  const body = base64UrlEncode(JSON.stringify(payload));\r\n  const data = `${header}.${body}`;\r\n  const sig = await crypto.subtle.sign('HMAC', key, new TextEncoder().encode(data));\r\n  return `${data}.${base64UrlEncode(sig)}`;\r\n}\r\n\r\nasync function verifyJwt(token, secret) {\r\n  const parts = token.split('.');\r\n  if (parts.length !== 3) throw new Error('Invalid JWT format');\r\n  const key = await importHmacKey(secret);\r\n  const data = `${parts[0]}.${parts[1]}`;\r\n  const sig = base64UrlDecode(parts[2]);\r\n  const valid = await crypto.subtle.verify('HMAC', key, sig, new TextEncoder().encode(data));\r\n  if (!valid) throw new Error('Invalid JWT signature');\r\n  const payload = JSON.parse(new TextDecoder().decode(base64UrlDecode(parts[1])));\r\n  if (payload.exp && payload.exp < Math.floor(Date.now() / 1000)) throw new Error('JWT expired');\r\n  return payload;\r\n}\r\n\r\n// \u2500\u2500\u2500 Google ID Token Verification \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nlet cachedGoogleKeys = null;\r\nlet googleKeysFetchedAt = 0;\r\nconst GOOGLE_KEYS_TTL_MS = 3600_000; // 1 hour\r\n\r\nasync function getGooglePublicKeys() {\r\n  if (cachedGoogleKeys && Date.now() - googleKeysFetchedAt < GOOGLE_KEYS_TTL_MS) {\r\n    return cachedGoogleKeys;\r\n  }\r\n  const resp = await fetch('https://www.googleapis.com/oauth2/v3/certs');\r\n  if (!resp.ok) throw new Error('Failed to fetch Google public keys');\r\n  const jwks = await resp.json();\r\n  cachedGoogleKeys = jwks.keys;\r\n  googleKeysFetchedAt = Date.now();\r\n  return cachedGoogleKeys;\r\n}\r\n\r\nasync function verifyGoogleIdToken(idToken, clientId, allowedDomain) {\r\n  const parts = idToken.split('.');\r\n  if (parts.length !== 3) throw new Error('Invalid ID token format');\r\n\r\n  const header = JSON.parse(new TextDecoder().decode(base64UrlDecode(parts[0])));\r\n  const payload = JSON.parse(new TextDecoder().decode(base64UrlDecode(parts[1])));\r\n\r\n  // Fetch and find matching key\r\n  const keys = await getGooglePublicKeys();\r\n  const jwk = keys.find(k => k.kid === header.kid);\r\n  if (!jwk) throw new Error('No matching Google key found for kid: ' + header.kid);\r\n\r\n  // Import RSA key and verify signature\r\n  const key = await crypto.subtle.importKey(\r\n    'jwk',\r\n    jwk,\r\n    { name: 'RSASSA-PKCS1-v1_5', hash: 'SHA-256' },\r\n    false,\r\n    ['verify']\r\n  );\r\n  const sig = base64UrlDecode(parts[2]);\r\n  const data = new TextEncoder().encode(`${parts[0]}.${parts[1]}`);\r\n  const valid = await crypto.subtle.verify('RSASSA-PKCS1-v1_5', key, sig, data);\r\n  if (!valid) throw new Error('Invalid Google ID token signature');\r\n\r\n  // Validate claims\r\n  const now = Math.floor(Date.now() / 1000);\r\n  if (payload.exp < now) throw new Error('ID token expired');\r\n  if (payload.aud !== clientId) throw new Error('ID token audience mismatch');\r\n  if (!['accounts.google.com', 'https://accounts.google.com'].includes(payload.iss)) {\r\n    throw new Error('ID token issuer mismatch');\r\n  }\r\n  if (allowedDomain && payload.hd !== allowedDomain) {\r\n    throw new Error(`Domain ${payload.hd} not allowed. Expected: ${allowedDomain}`);\r\n  }\r\n  if (!payload.email_verified) throw new Error('Email not verified');\r\n\r\n  return payload;\r\n}\r\n\r\n// \u2500\u2500\u2500 Auth Middleware \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\n/** Verify the Authorization: Bearer <jwt> header. Returns payload or null. */\r\nasync function authenticateRequest(request, env) {\r\n  const auth = request.headers.get('Authorization');\r\n  if (!auth || !auth.startsWith('Bearer ')) return null;\r\n  try {\r\n    return await verifyJwt(auth.slice(7), env.JWT_SECRET);\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/** Return 401 response */\r\nfunction unauthorized(origin, message = 'Unauthorized') {\r\n  return corsResponse(origin, { error: message }, { status: 401 });\r\n}\r\n\r\n// \u2500\u2500\u2500 Route: POST /auth/verify \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function handleAuthVerify(request, env) {\r\n  const origin = request.headers.get('Origin') || '';\r\n  try {\r\n    const { idToken } = await request.json();\r\n    if (!idToken) return corsResponse(origin, { error: 'Missing idToken' }, { status: 400 });\r\n\r\n    const googlePayload = await verifyGoogleIdToken(idToken, env.GOOGLE_CLIENT_ID, env.ALLOWED_DOMAIN);\r\n\r\n    const now = Math.floor(Date.now() / 1000);\r\n    const jwt = await signJwt({\r\n      sub: googlePayload.sub,\r\n      email: googlePayload.email,\r\n      name: googlePayload.name,\r\n      picture: googlePayload.picture,\r\n      hd: googlePayload.hd,\r\n      iat: now,\r\n      exp: now + JWT_EXPIRY_SECONDS,\r\n    }, env.JWT_SECRET);\r\n\r\n    return corsResponse(origin, {\r\n      token: jwt,\r\n      expiresIn: JWT_EXPIRY_SECONDS,\r\n      user: {\r\n        email: googlePayload.email,\r\n        name: googlePayload.name,\r\n        picture: googlePayload.picture,\r\n        domain: googlePayload.hd,\r\n      },\r\n    });\r\n  } catch (err) {\r\nreturn corsResponse(origin, { error: 'Authentication failed: ' + err.message }, { status: 401 });\r\n  }\r\n}\r\n\r\n// \u2500\u2500\u2500 Route: /api/gemini/* (passthrough proxy) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function handleGeminiProxy(request, env, subpath) {\r\n  const origin = request.headers.get('Origin') || '';\r\n  const url = `${GEMINI_API_BASE}/${subpath}`;\r\n\r\n  const headers = new Headers();\r\n  headers.set('x-goog-api-key', env.GEMINI_API_KEY);\r\n\r\n  // Forward content-type\r\n  const ct = request.headers.get('Content-Type');\r\n  if (ct) headers.set('Content-Type', ct);\r\n\r\n  const upstreamResp = await fetch(url, {\r\n    method: request.method,\r\n    headers,\r\n    body: request.method !== 'GET' ? request.body : undefined,\r\n  });\r\n\r\n  // Stream the response back with CORS headers\r\n  const respHeaders = { ...getCorsHeaders(origin) };\r\n  const upstreamCt = upstreamResp.headers.get('Content-Type');\r\n  if (upstreamCt) respHeaders['Content-Type'] = upstreamCt;\r\n\r\n  return new Response(upstreamResp.body, {\r\n    status: upstreamResp.status,\r\n    headers: respHeaders,\r\n  });\r\n}\r\n\r\n// \u2500\u2500\u2500 Route: POST /api/veo/generate \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function handleVeoGenerate(request, env) {\r\n  const origin = request.headers.get('Origin') || '';\r\n  try {\r\n    const body = await request.json();\r\n    const {\r\n      prompt, image, durationSeconds = 8, aspectRatio = '16:9',\r\n      resolution = '1080p', generateAudio = false,\r\n      personGeneration = 'allow_adult', seed, numberOfVideos,\r\n      useVertexAi = false,\r\n    } = body;\r\n\r\n    // Build instances\r\n    const instance = { prompt };\r\n    if (image?.bytesBase64Encoded && image?.mimeType) {\r\n      instance.image = { bytesBase64Encoded: image.bytesBase64Encoded, mimeType: image.mimeType };\r\n    }\r\n\r\n    const parameters = { durationSeconds, aspectRatio, resolution, personGeneration };\r\n    if (seed !== undefined) parameters.seed = seed;\r\n\r\n    let endpoint, reqHeaders;\r\n\r\n    if (useVertexAi && env.VERTEX_AI_TOKEN && env.GOOGLE_PROJECT_ID) {\r\n      // Vertex AI approach\r\n      parameters.generateAudio = generateAudio;\r\n      if (numberOfVideos) parameters.sampleCount = numberOfVideos;\r\n      endpoint = `${VERTEX_AI_BASE}/projects/${env.GOOGLE_PROJECT_ID}/locations/us-central1/publishers/google/models/veo-3.1-generate-preview:predictLongRunning`;\r\n      reqHeaders = {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${env.VERTEX_AI_TOKEN}`,\r\n        'x-goog-user-project': env.GOOGLE_PROJECT_ID,\r\n      };\r\n    } else {\r\n      // Gemini API approach (recommended)\r\n      if (numberOfVideos) parameters.numberOfVideos = numberOfVideos;\r\n      endpoint = `${GEMINI_API_BASE}/models/veo-3.1-generate-preview:predictLongRunning`;\r\n      reqHeaders = {\r\n        'Content-Type': 'application/json',\r\n        'x-goog-api-key': env.GEMINI_API_KEY,\r\n      };\r\n    }\r\n\r\n    const resp = await fetch(endpoint, {\r\n      method: 'POST',\r\n      headers: reqHeaders,\r\n      body: JSON.stringify({ instances: [instance], parameters }),\r\n    });\r\n\r\n    if (!resp.ok) {\r\n      const errText = await resp.text();\r\n      let msg = `API error (${resp.status})`;\r\n      try { msg = JSON.parse(errText).error?.message || msg; } catch {}\r\n      return corsResponse(origin, { status: 'error', error: msg }, { status: resp.status });\r\n    }\r\n\r\n    const data = await resp.json();\r\n    if (!data.name) {\r\n      return corsResponse(origin, { status: 'error', error: 'No operation name returned' }, { status: 500 });\r\n    }\r\n\r\n    // Quick-poll a few times\r\n    const token = useVertexAi ? env.VERTEX_AI_TOKEN : null;\r\n    const projectId = useVertexAi ? env.GOOGLE_PROJECT_ID : null;\r\n\r\n    for (let i = 0; i < QUICK_POLL_ATTEMPTS; i++) {\r\n      await sleep(POLL_INTERVAL_MS);\r\n      const result = await checkVeoOperation(data.name, env, useVertexAi);\r\n      if (result.status === 'complete' || result.status === 'error') {\r\n        return corsResponse(origin, result);\r\n      }\r\n    }\r\n\r\n    return corsResponse(origin, {\r\n      status: 'processing',\r\n      operationName: data.name,\r\n      message: 'Video generation in progress. Poll /api/veo/status for updates.',\r\n    });\r\n  } catch (err) {\r\nreturn corsResponse(origin, { status: 'error', error: err.message }, { status: 500 });\r\n  }\r\n}\r\n\r\n// \u2500\u2500\u2500 Route: GET /api/veo/status \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function handleVeoStatus(request, env) {\r\n  const origin = request.headers.get('Origin') || '';\r\n  const url = new URL(request.url);\r\n  const operationName = url.searchParams.get('operation');\r\n  const useVertexAi = url.searchParams.get('useVertexAi') === 'true';\r\n\r\n  if (!operationName) {\r\n    return corsResponse(origin, { error: 'Missing operation parameter' }, { status: 400 });\r\n  }\r\n\r\n  const result = await checkVeoOperation(operationName, env, useVertexAi);\r\n  return corsResponse(origin, result);\r\n}\r\n\r\n/** Check a Veo operation status */\r\nasync function checkVeoOperation(operationName, env, useVertexAi) {\r\n  try {\r\n    if (useVertexAi) {\r\n      return await checkVeoVertexOperation(operationName, env);\r\n    }\r\n    // Gemini API: GET the operation\r\n    const resp = await fetch(`${GEMINI_API_BASE}/${operationName}`, {\r\n      headers: { 'x-goog-api-key': env.GEMINI_API_KEY },\r\n    });\r\n    if (!resp.ok) {\r\n      return { status: 'error', error: `Status check failed (${resp.status})` };\r\n    }\r\n    const data = await resp.json();\r\n    if (data.done) {\r\n      if (data.error) return { status: 'error', error: data.error.message || 'Operation failed' };\r\n      const videoUrl = extractGeminiVideoUrl(data.response);\r\n      if (videoUrl) {\r\n        return { status: 'complete', videoUrl, expiresAt: new Date(Date.now() + 2 * 86400000).toISOString() };\r\n      }\r\n      return { status: 'error', error: 'No video URL in completed response' };\r\n    }\r\n    return { status: 'processing', operationName };\r\n  } catch (err) {\r\n    return { status: 'error', error: err.message };\r\n  }\r\n}\r\n\r\n/** Check Vertex AI operation (legacy) */\r\nasync function checkVeoVertexOperation(operationName, env) {\r\n  try {\r\n    const projectMatch = operationName.match(/projects\\/([^/]+)/);\r\n    const locationMatch = operationName.match(/locations\\/([^/]+)/);\r\n    const modelMatch = operationName.match(/models\\/([^/]+)/);\r\n    if (!projectMatch || !locationMatch || !modelMatch) {\r\n      return { status: 'error', error: 'Could not parse operation name' };\r\n    }\r\n    const fetchUrl = `${VERTEX_AI_BASE}/projects/${projectMatch[1]}/locations/${locationMatch[1]}/publishers/google/models/${modelMatch[1]}:fetchPredictOperation`;\r\n    const resp = await fetch(fetchUrl, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${env.VERTEX_AI_TOKEN}`,\r\n        'x-goog-user-project': env.GOOGLE_PROJECT_ID,\r\n      },\r\n      body: JSON.stringify({ operationName }),\r\n    });\r\n    if (!resp.ok) return { status: 'error', error: `API returned ${resp.status}` };\r\n    const data = await resp.json();\r\n    if (data.done) {\r\n      if (data.error) return { status: 'error', error: data.error.message || 'Failed' };\r\n      const videoUrl = extractVertexVideoUrl(data.response);\r\n      if (videoUrl) return { status: 'complete', videoUrl, expiresAt: new Date(Date.now() + 2 * 86400000).toISOString() };\r\n      return { status: 'error', error: 'No video URL found' };\r\n    }\r\n    return { status: 'processing', operationName };\r\n  } catch (err) {\r\n    return { status: 'error', error: err.message };\r\n  }\r\n}\r\n\r\nfunction extractGeminiVideoUrl(response) {\r\n  try {\r\n    const samples = response?.generateVideoResponse?.generatedSamples;\r\n    if (samples?.[0]?.video?.uri) return samples[0].video.uri;\r\n  } catch {}\r\n  return null;\r\n}\r\n\r\nfunction extractVertexVideoUrl(response) {\r\n  if (response?.predictions?.[0]) {\r\n    const p = response.predictions[0];\r\n    return p.videoUrl || p.videoUri || p.video_url || p.video?.url || p.video?.uri || null;\r\n  }\r\n  if (response?.video?.url || response?.videoUrl) return response.video?.url || response.videoUrl;\r\n  return null;\r\n}\r\n\r\n// \u2500\u2500\u2500 Route: POST /api/kling/generate \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function handleKlingGenerate(request, env) {\r\n  const origin = request.headers.get('Origin') || '';\r\n  try {\r\n    const body = await request.json();\r\n    const { provider = 'piapi', ...params } = body;\r\n\r\n    const endpoint = KLING_ENDPOINTS[provider];\r\n    if (!endpoint) return corsResponse(origin, { error: `Unknown Kling provider: ${provider}` }, { status: 400 });\r\n\r\n    const keyMap = { piapi: env.KLING_PIAPI_API_KEY, ulazai: env.KLING_ULAZAI_API_KEY, wavespeedai: env.KLING_WAVESPEEDAI_API_KEY };\r\n    const apiKey = keyMap[provider];\r\n    if (!apiKey) return corsResponse(origin, { error: `No API key configured for provider: ${provider}` }, { status: 500 });\r\n\r\n    // Build provider-specific payload\r\n    let url, payload;\r\n    if (provider === 'piapi') {\r\n      url = `${endpoint.base}/video/generation`;\r\n      payload = buildPiApiPayload(params);\r\n    } else if (provider === 'ulazai') {\r\n      url = `${endpoint.base}/video/generate`;\r\n      payload = buildUlazAiPayload(params);\r\n    } else {\r\n      url = `${endpoint.base}/generate`;\r\n      payload = buildWaveSpeedPayload(params);\r\n    }\r\n\r\n    const resp = await fetch(url, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${apiKey}`,\r\n      },\r\n      body: JSON.stringify(payload),\r\n    });\r\n\r\n    if (!resp.ok) {\r\n      const errText = await resp.text();\r\n      return corsResponse(origin, { error: `Kling API error (${resp.status}): ${errText}` }, { status: resp.status });\r\n    }\r\n\r\n    const data = await resp.json();\r\n    const taskId = data.task_id || data.id || data.taskId;\r\n    return corsResponse(origin, { taskId, provider, raw: data });\r\n  } catch (err) {\r\n    return corsResponse(origin, { error: err.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nfunction buildPiApiPayload(p) {\r\n  const payload = {\r\n    model: 'kling-v1-5',\r\n    prompt: p.prompt,\r\n    duration: p.duration || 5,\r\n    aspect_ratio: p.aspectRatio || '16:9',\r\n    mode: p.inputImage ? 'image2video' : 'text2video',\r\n  };\r\n  if (p.inputImage) payload.image_url = p.inputImage;\r\n  if (p.camera) {\r\n    payload.camera_control = {\r\n      type: p.camera.type,\r\n      speed: p.camera.speed || 'normal',\r\n      direction: p.camera.direction || 0,\r\n      smoothness: (p.camera.smoothness || 50) / 100,\r\n    };\r\n  }\r\n  return payload;\r\n}\r\n\r\nfunction buildUlazAiPayload(p) {\r\n  const payload = {\r\n    text: p.prompt,\r\n    duration: (p.duration || 5) + 's',\r\n    ratio: p.aspectRatio || '16:9',\r\n    mode: p.inputImage ? 'img2video' : 'txt2video',\r\n    quality: p.quality || 'standard',\r\n  };\r\n  if (p.inputImage) payload.image = p.inputImage;\r\n  if (p.camera) {\r\n    payload.camera_movement = {\r\n      type: p.camera.type,\r\n      strength: (p.camera.smoothness || 50) / 100,\r\n      angle: p.camera.direction || 0,\r\n    };\r\n  }\r\n  return payload;\r\n}\r\n\r\nfunction buildWaveSpeedPayload(p) {\r\n  const payload = {\r\n    prompt: p.prompt,\r\n    video_length: p.duration || 5,\r\n    aspect_ratio: p.aspectRatio || '16:9',\r\n  };\r\n  if (p.inputImage) payload.image = p.inputImage;\r\n  if (p.seed !== undefined) payload.seed = p.seed;\r\n  if (p.camera) {\r\n    payload.camera = {\r\n      motion: p.camera.type,\r\n      direction: p.camera.direction || 0,\r\n      speed: p.camera.speed || 'normal',\r\n      smoothness: p.camera.smoothness || 50,\r\n    };\r\n  }\r\n  return payload;\r\n}\r\n\r\n// \u2500\u2500\u2500 Route: GET /api/kling/status \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function handleKlingStatus(request, env) {\r\n  const origin = request.headers.get('Origin') || '';\r\n  const url = new URL(request.url);\r\n  const taskId = url.searchParams.get('taskId');\r\n  const provider = url.searchParams.get('provider') || 'piapi';\r\n\r\n  if (!taskId) return corsResponse(origin, { error: 'Missing taskId' }, { status: 400 });\r\n\r\n  const endpoint = KLING_ENDPOINTS[provider];\r\n  if (!endpoint) return corsResponse(origin, { error: `Unknown provider: ${provider}` }, { status: 400 });\r\n\r\n  const keyMap = { piapi: env.KLING_PIAPI_API_KEY, ulazai: env.KLING_ULAZAI_API_KEY, wavespeedai: env.KLING_WAVESPEEDAI_API_KEY };\r\n  const apiKey = keyMap[provider];\r\n\r\n  let statusUrl;\r\n  if (provider === 'piapi') statusUrl = `${endpoint.base}/video/${taskId}`;\r\n  else if (provider === 'ulazai') statusUrl = `${endpoint.base}/video/status/${taskId}`;\r\n  else statusUrl = `${endpoint.base}/status/${taskId}`;\r\n\r\n  try {\r\n    const resp = await fetchWithRetry(\r\n      (signal) => fetch(statusUrl, {\r\n        headers: { 'Authorization': `Bearer ${apiKey}` },\r\n        signal,\r\n      }),\r\n      { maxRetries: 2, timeoutMs: 15000, label: 'Kling status' },\r\n    );\r\n    if (!resp.ok) {\r\n      return corsResponse(origin, { error: `Status check failed (${resp.status})` }, { status: resp.status });\r\n    }\r\n    const data = await resp.json();\r\n    return corsResponse(origin, data);\r\n  } catch (err) {\r\n    return corsResponse(origin, { error: err.message }, { status: 500 });\r\n  }\r\n}\r\n\r\n// \u2500\u2500\u2500 Route: POST /api/convert/pdf-to-docx \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function handleConvertApi(request, env) {\r\n  const origin = request.headers.get('Origin') || '';\r\n  try {\r\n    const body = await request.json();\r\n    const { fileName, fileData } = body;\r\n\r\n    if (!fileData) return corsResponse(origin, { error: 'Missing fileData (base64)' }, { status: 400 });\r\n\r\n    const convertBody = JSON.stringify({\r\n      Parameters: [{ Name: 'File', FileValue: { Name: fileName || 'document.pdf', Data: fileData } }],\r\n    });\r\n    const resp = await fetchWithRetry(\r\n      (signal) => fetch(`${CONVERTAPI_BASE}/convert/pdf/to/docx?Secret=${env.CONVERTAPI_SECRET}`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: convertBody,\r\n        signal,\r\n      }),\r\n      { maxRetries: 2, timeoutMs: 60000, label: 'ConvertAPI' },\r\n    );\r\n\r\n    if (!resp.ok) {\r\n      const errText = await resp.text();\r\n      return corsResponse(origin, { error: `ConvertAPI error (${resp.status}): ${errText}` }, { status: resp.status });\r\n    }\r\n\r\n    const data = await resp.json();\r\n    return corsResponse(origin, data);\r\n  } catch (err) {\r\n    return corsResponse(origin, { error: err.message }, { status: 500 });\r\n  }\r\n}\r\n\r\n// \u2500\u2500\u2500 Route: /api/ilovepdf/* (multi-step passthrough proxy) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function handleILovePdfProxy(request, env, subpath) {\r\n  const origin = request.headers.get('Origin') || '';\r\n  try {\r\n    if (subpath === 'auth') {\r\n      // Step 1: Authenticate with iLovePDF using our secret key\r\n      const authBody = JSON.stringify({ public_key: env.ILOVEPDF_PUBLIC_KEY });\r\n      const resp = await fetchWithRetry(\r\n        (signal) => fetch(`${ILOVEPDF_BASE}/auth`, {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: authBody,\r\n          signal,\r\n        }),\r\n        { maxRetries: 2, timeoutMs: 15000, label: 'iLovePDF auth' },\r\n      );\r\n      if (!resp.ok) {\r\n        const errText = await resp.text();\r\n        return corsResponse(origin, { error: `iLovePDF auth failed: ${errText}` }, { status: resp.status });\r\n      }\r\n      const data = await resp.json();\r\n      return corsResponse(origin, data);\r\n    }\r\n\r\n    if (subpath.startsWith('start/')) {\r\n      // Step 2: Start a task (e.g., start/pdfdocx or start/compress)\r\n      const tool = subpath.replace('start/', '');\r\n      const body = await request.json();\r\n      const iToken = body.ilovepdfToken;\r\n      if (!iToken) return corsResponse(origin, { error: 'Missing ilovepdfToken' }, { status: 400 });\r\n\r\n      const resp = await fetchWithRetry(\r\n        (signal) => fetch(`${ILOVEPDF_BASE}/start/${tool}`, {\r\n          headers: { 'Authorization': `Bearer ${iToken}` },\r\n          signal,\r\n        }),\r\n        { maxRetries: 2, timeoutMs: 15000, label: 'iLovePDF start' },\r\n      );\r\n      if (!resp.ok) {\r\n        const errText = await resp.text();\r\n        return corsResponse(origin, { error: `Start task failed: ${errText}` }, { status: resp.status });\r\n      }\r\n      return corsResponse(origin, await resp.json());\r\n    }\r\n\r\n    if (subpath === 'upload') {\r\n      // Step 3: Upload file to the dynamic server\r\n      const body = await request.json();\r\n      const { server, task, ilovepdfToken, fileData, fileName } = body;\r\n      if (!server || !task || !ilovepdfToken || !fileData) {\r\n        return corsResponse(origin, { error: 'Missing required upload fields' }, { status: 400 });\r\n      }\r\n\r\n      // Convert base64 to blob and upload via FormData\r\n      const binaryStr = atob(fileData);\r\n      const bytes = new Uint8Array(binaryStr.length);\r\n      for (let i = 0; i < binaryStr.length; i++) bytes[i] = binaryStr.charCodeAt(i);\r\n      const blob = new Blob([bytes], { type: 'application/pdf' });\r\n\r\n      const formData = new FormData();\r\n      formData.append('task', task);\r\n      formData.append('file', blob, fileName || 'document.pdf');\r\n\r\n      const resp = await fetchWithRetry(\r\n        (signal) => fetch(`https://${server}/v1/upload`, {\r\n          method: 'POST',\r\n          headers: { 'Authorization': `Bearer ${ilovepdfToken}` },\r\n          body: formData,\r\n          signal,\r\n        }),\r\n        { maxRetries: 2, timeoutMs: 60000, label: 'iLovePDF upload' },\r\n      );\r\n      if (!resp.ok) {\r\n        const errText = await resp.text();\r\n        return corsResponse(origin, { error: `Upload failed: ${errText}` }, { status: resp.status });\r\n      }\r\n      return corsResponse(origin, await resp.json());\r\n    }\r\n\r\n    if (subpath === 'process') {\r\n      // Step 4: Process the task\r\n      const body = await request.json();\r\n      const { server, ilovepdfToken, ...processPayload } = body;\r\n      if (!server || !ilovepdfToken) {\r\n        return corsResponse(origin, { error: 'Missing server or ilovepdfToken' }, { status: 400 });\r\n      }\r\n\r\n      const processBody = JSON.stringify(processPayload);\r\n      const resp = await fetchWithRetry(\r\n        (signal) => fetch(`https://${server}/v1/process`, {\r\n          method: 'POST',\r\n          headers: {\r\n            'Authorization': `Bearer ${ilovepdfToken}`,\r\n            'Content-Type': 'application/json',\r\n          },\r\n          body: processBody,\r\n          signal,\r\n        }),\r\n        { maxRetries: 2, timeoutMs: 60000, label: 'iLovePDF process' },\r\n      );\r\n      if (!resp.ok) {\r\n        const errText = await resp.text();\r\n        return corsResponse(origin, { error: `Process failed: ${errText}` }, { status: resp.status });\r\n      }\r\n      // process may return empty body on success\r\n      const text = await resp.text();\r\n      return corsResponse(origin, text ? JSON.parse(text) : { success: true });\r\n    }\r\n\r\n    if (subpath.startsWith('download/')) {\r\n      // Step 5: Download the result\r\n      const taskId = subpath.replace('download/', '');\r\n      const url = new URL(request.url);\r\n      const server = url.searchParams.get('server');\r\n      const iToken = url.searchParams.get('token');\r\n      if (!server || !iToken) {\r\n        return corsResponse(origin, { error: 'Missing server or token params' }, { status: 400 });\r\n      }\r\n\r\n      const resp = await fetchWithRetry(\r\n        (signal) => fetch(`https://${server}/v1/download/${taskId}`, {\r\n          headers: { 'Authorization': `Bearer ${iToken}` },\r\n          signal,\r\n        }),\r\n        { maxRetries: 2, timeoutMs: 60000, label: 'iLovePDF download' },\r\n      );\r\n      if (!resp.ok) {\r\n        return corsResponse(origin, { error: `Download failed (${resp.status})` }, { status: resp.status });\r\n      }\r\n\r\n      // Return binary response\r\n      return new Response(resp.body, {\r\n        headers: {\r\n          ...getCorsHeaders(origin),\r\n          'Content-Type': resp.headers.get('Content-Type') || 'application/octet-stream',\r\n          'Content-Disposition': resp.headers.get('Content-Disposition') || '',\r\n        },\r\n      });\r\n    }\r\n\r\n    return corsResponse(origin, { error: `Unknown iLovePDF endpoint: ${subpath}` }, { status: 404 });\r\n  } catch (err) {\r\n    return corsResponse(origin, { error: err.message }, { status: 500 });\r\n  }\r\n}\r\n\r\n// \u2500\u2500\u2500 URL Fetch Proxy (for material validation link fetching) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nasync function handleFetchUrl(request, env) {\r\n  const origin = request.headers.get('Origin') || '';\r\n  const reqUrl = new URL(request.url);\r\n  const targetUrl = reqUrl.searchParams.get('url');\r\n\r\n  if (!targetUrl) {\r\n    return corsResponse(origin, { error: 'Missing url parameter' }, { status: 400 });\r\n  }\r\n\r\n  let parsedUrl;\r\n  try {\r\n    let normalizedUrl = targetUrl;\r\n    if (normalizedUrl.startsWith('www.')) {\r\n      normalizedUrl = `https://${normalizedUrl}`;\r\n    }\r\n    parsedUrl = new URL(normalizedUrl);\r\n    if (!['http:', 'https:'].includes(parsedUrl.protocol)) {\r\n      throw new Error('Invalid protocol');\r\n    }\r\n  } catch {\r\n    return corsResponse(origin, { error: 'Invalid URL' }, { status: 400 });\r\n  }\r\n\r\n  try {\r\n    const resp = await fetchWithRetry(\r\n      (signal) => fetch(parsedUrl.href, {\r\n        headers: {\r\n          'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',\r\n          'User-Agent': 'ArchVizAIStudio/1.0',\r\n        },\r\n        signal,\r\n        redirect: 'follow',\r\n      }),\r\n      { maxRetries: 1, timeoutMs: 10000, label: 'URL fetch' }\r\n    );\r\n\r\n    if (!resp.ok) {\r\n      return corsResponse(origin, {\r\n        url: parsedUrl.href,\r\n        content: '',\r\n        fetchedAt: Date.now(),\r\n        error: `HTTP ${resp.status}`\r\n      });\r\n    }\r\n\r\n    const html = await resp.text();\r\n    const titleMatch = html.match(/<title[^>]*>([^<]*)<\\/title>/i);\r\n    const title = titleMatch ? titleMatch[1].trim() : undefined;\r\n    const content = html\r\n      .replace(/<script[^>]*>[\\s\\S]*?<\\/script>/gi, '')\r\n      .replace(/<style[^>]*>[\\s\\S]*?<\\/style>/gi, '')\r\n      .replace(/<[^>]+>/g, ' ')\r\n      .replace(/\\s+/g, ' ')\r\n      .trim()\r\n      .slice(0, 3000);\r\n\r\n    return corsResponse(origin, {\r\n      url: parsedUrl.href,\r\n      title,\r\n      content,\r\n      fetchedAt: Date.now()\r\n    });\r\n  } catch (err) {\r\n    return corsResponse(origin, {\r\n      url: parsedUrl.href,\r\n      content: '',\r\n      fetchedAt: Date.now(),\r\n      error: err.message\r\n    });\r\n  }\r\n}\r\n\r\n// \u2500\u2500\u2500 Router \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nexport default {\r\n  async fetch(request, env, ctx) {\r\n    const url = new URL(request.url);\r\n    const path = url.pathname;\r\n    const origin = request.headers.get('Origin') || '';\r\n\r\n    // CORS preflight\r\n    if (request.method === 'OPTIONS') return handleOptions(request);\r\n\r\n    // Payload size check for POST requests\r\n    if (request.method === 'POST') {\r\n      const cl = parseInt(request.headers.get('Content-Length') || '0', 10);\r\n      if (cl > MAX_PAYLOAD_BYTES) {\r\n        return corsResponse(origin, { error: 'Payload too large' }, { status: 413 });\r\n      }\r\n    }\r\n\r\n    // \u2500\u2500 Public routes (no JWT required) \u2500\u2500\r\n    if (path === '/auth/verify' && request.method === 'POST') {\r\n      return handleAuthVerify(request, env);\r\n    }\r\n\r\n    // Health check\r\n    if (path === '/health') {\r\n      return corsResponse(origin, { status: 'ok', timestamp: new Date().toISOString() });\r\n    }\r\n\r\n    // \u2500\u2500 Protected routes (JWT required) \u2500\u2500\r\n    const user = await authenticateRequest(request, env);\r\n    if (!user) return unauthorized(origin);\r\n\r\n    // Gemini passthrough: /api/gemini/{anything}\r\n    if (path.startsWith('/api/gemini/')) {\r\n      const subpath = path.replace('/api/gemini/', '') + url.search;\r\n      return handleGeminiProxy(request, env, subpath);\r\n    }\r\n\r\n    // Veo video generation\r\n    if (path === '/api/veo/generate' && request.method === 'POST') return handleVeoGenerate(request, env);\r\n    if (path === '/api/veo/status' && request.method === 'GET') return handleVeoStatus(request, env);\r\n\r\n    // Kling video generation\r\n    if (path === '/api/kling/generate' && request.method === 'POST') return handleKlingGenerate(request, env);\r\n    if (path === '/api/kling/status' && request.method === 'GET') return handleKlingStatus(request, env);\r\n\r\n    // ConvertAPI\r\n    if (path === '/api/convert/pdf-to-docx' && request.method === 'POST') return handleConvertApi(request, env);\r\n\r\n    // iLovePDF multi-step proxy\r\n    if (path.startsWith('/api/ilovepdf/')) {\r\n      const subpath = path.replace('/api/ilovepdf/', '');\r\n      return handleILovePdfProxy(request, env, subpath);\r\n    }\r\n\r\n    // URL fetch proxy (material validation link fetching)\r\n    if (path === '/api/fetch-url' && request.method === 'GET') return handleFetchUrl(request, env);\r\n\r\n    return corsResponse(origin, { error: 'Not found' }, { status: 404 });\r\n  },\r\n};\r\n\r\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"C:\\\\Users\\\\1Pax Mateja\\\\Documents\\\\ArchViz\\\\ArchViz-AI-Studio\\\\cloudflare-worker\\\\worker.js\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"C:\\\\Users\\\\1Pax Mateja\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"C:\\\\Users\\\\1Pax Mateja\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"C:\\\\Users\\\\1Pax Mateja\\\\Documents\\\\ArchViz\\\\ArchViz-AI-Studio\\\\cloudflare-worker\\\\worker.js\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"C:\\\\Users\\\\1Pax Mateja\\\\Documents\\\\ArchViz\\\\ArchViz-AI-Studio\\\\cloudflare-worker\\\\.wrangler\\\\tmp\\\\bundle-RGYhRm\\\\middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"C:\\\\Users\\\\1Pax Mateja\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\common.ts\";\nimport type { WorkerEntrypointConstructor } from \"C:\\\\Users\\\\1Pax Mateja\\\\Documents\\\\ArchViz\\\\ArchViz-AI-Studio\\\\cloudflare-worker\\\\.wrangler\\\\tmp\\\\bundle-RGYhRm\\\\middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"C:\\\\Users\\\\1Pax Mateja\\\\Documents\\\\ArchViz\\\\ArchViz-AI-Studio\\\\cloudflare-worker\\\\.wrangler\\\\tmp\\\\bundle-RGYhRm\\\\middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n"],
  "mappings": "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",
  "names": []
}
